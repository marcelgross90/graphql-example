version: '2.2'
services:
  db:
    init: true
    container_name: "graphql_mysql"
    image: percona:5.7
    ports:
     - 3306:3306
    environment:
      MYSQL_RANDOM_ROOT_PASSWORD: "true"
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_DATABASE: graphql
    command: ['--character-set-server=utf8mb4', '--collation-server=utf8mb4_unicode_ci', '--max_allowed_packet=1024M']
    volumes:
      - "./graphql.build/mysql/data:/var/lib/mysql/"

  app:
    init: true
    build: "."
    ports:
      - 8181:8080
      - 8787:8787
    environment:
      MYSQL_URL: jdbc:mysql://db:3306/graphql
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
    entrypoint:
      - java
      - -Xdebug
      - -Xrunjdwp:server=y,transport=dt_socket,address=8787,suspend=n
      - -jar
      - -Done-jar.silent=true
      - -Dspring.profiles.active=docker
      - employeeAppraisal-full.jar
    depends_on:
      - "db"